---
import Pagination from "@components/posts/Pagination.astro";
import PostCards from "@components/posts/PostCards.astro";
import MainLayout from "@layouts/MainLayout.astro";
import BlogCollection from "@utils/blog";
import type { CollectionEntry } from "astro:content";

export interface Props {
  posts: CollectionEntry<"blog">[];
  pages: number[];
}

export async function getStaticPaths() {
  const blogCollection = new BlogCollection();
  await blogCollection.getCollection();

  const lastPage = blogCollection.lastPage();
  const pages = Array.from({ length: lastPage }, (_, index) => index + 1);

  return pages.map(page => ({
    params: { page: page },
    props: { posts: blogCollection.getPage(page), pages },
  }));
}

const { posts, pages } = Astro.props;
const { page } = Astro.params;
---

<MainLayout title="Posts">
  <PostCards posts={posts} sectionName="posts" header={`Page ${page}`} />
  <Pagination pages={pages} currentPage={page} />
</MainLayout>
