---
import LightMode from "~icons/ic/round-light-mode";
import DarkMode from "~icons/ic/round-dark-mode";
---

<button id="theme-button" aria-live="polite" aria-label="auto">
  <div id="light" class="hidden">
    <LightMode />
  </div>
  <div id="dark" class="hidden">
    <DarkMode />
  </div>
</button>

<script>
  function onLoad() {
    const darkIcon = document.getElementById("dark");
    const lightIcon = document.getElementById("light");

    const changeIcon = (theme: string) => {
      if (theme === "dark") {
        lightIcon?.classList.add("hidden");
        darkIcon?.classList.remove("hidden");
      } else {
        lightIcon?.classList.remove("hidden");
        darkIcon?.classList.add("hidden");
      }
    };

    const preferedTheme = window.matchMedia("(prefers-color-scheme: dark)")
      .matches
      ? "dark"
      : "light";
    let currentTheme = localStorage.getItem("theme") ?? preferedTheme ?? "dark";

    document.documentElement.setAttribute("data-theme", currentTheme);

    changeIcon(currentTheme);

    const themeButton = document.getElementById("theme-button");
    themeButton?.addEventListener("click", () => {
      currentTheme = currentTheme === "dark" ? "light" : "dark";

      document.documentElement.setAttribute("data-theme", currentTheme);
      localStorage.setItem("theme", currentTheme);

      changeIcon(currentTheme);
    });
  }

  onLoad();
</script>
